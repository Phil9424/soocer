{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="game-page pre-match-page">
        <div class="match-header">
            <h1>‚öΩ –ü—Ä–µ–¥–º–∞—Ç—á–µ–≤—ã–π —ç–∫—Ä–∞–Ω</h1>
            <div class="match-teams">
                <div class="team-info-with-logo">
                    {% set my_logo = TEAM_LOGOS.get(my_team, TEAM_LOGOS_FALLBACK.get(my_team, '')) %}
                    {% if my_logo %}
                    <img src="{{ my_logo }}" alt="{{ my_team }}" class="team-logo-small" style="width: 30px !important; height: 30px !important; object-fit: contain !important;">
                    {% else %}
                    <div class="team-logo-placeholder">‚öΩ</div>
                    {% endif %}
                    <div class="team-name">{{ my_team }}</div>
                </div>
                <div class="vs">VS</div>
                <div class="team-info-with-logo">
                    {% set opp_logo = TEAM_LOGOS.get(opponent_team, TEAM_LOGOS_FALLBACK.get(opponent_team, '')) %}
                    {% if opp_logo %}
                    <img src="{{ opp_logo }}" alt="{{ opponent_team }}" class="team-logo-small" style="width: 30px !important; height: 30px !important; object-fit: contain !important;">
                    {% else %}
                    <div class="team-logo-placeholder">‚öΩ</div>
                    {% endif %}
                    <div class="team-name">{{ opponent_team }}</div>
                </div>
            </div>
            <div class="match-info">
                <div class="match-info-item">
                    <span>üèüÔ∏è</span>
                    <span>{{ stadium_name }}</span>
                </div>
                <div class="match-info-item">
                    <span>üïê</span>
                    <span>{{ match_time }}</span>
                </div>
                <div class="match-info-item">
                    <span>üë•</span>
                    <span>{{ "{:,}".format(attendance) }}/{{ "{:,}".format(stadium_capacity) }}</span>
                </div>
            </div>
        </div>
        
        <div class="lineups-container">
            <div class="lineup-list">
                {% set max_players = [my_lineup|length, opponent_lineup|length]|max %}
                {% for i in range(max_players) %}
                <div class="lineup-row">
                    <div class="lineup-player lineup-player-left">
                        {% if i < my_lineup|length %}
                        <span class="lineup-player-position">{{ my_lineup[i].position }}</span>
                        <span class="lineup-player-name">{{ my_lineup[i].name }}</span>
                        {% else %}
                        <span class="lineup-player-name">-</span>
                        {% endif %}
                    </div>
                    <div class="lineup-player lineup-player-right">
                        {% if i < opponent_lineup|length %}
                        <span class="lineup-player-position">{{ opponent_lineup[i].position }}</span>
                        <span class="lineup-player-name">{{ opponent_lineup[i].name }}</span>
                        {% else %}
                        <span class="lineup-player-name">-</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="match-actions">
            <a href="{{ url_for('game_page', page=3) }}" class="btn btn-secondary">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</a>
            <button class="btn btn-primary" onclick="showTactics()">‚öΩ –¢–∞–∫—Ç–∏–∫–∞</button>
            <button class="btn btn-success" onclick="startMatch()">üöÄ –ù–∞—á–∞—Ç—å</button>
            <a href="{{ url_for('game_page', page=1) }}" class="btn btn-danger">‚ùå –û—Ç–º–µ–Ω–∞</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showTactics() {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    `;

    modal.innerHTML = `
        <div style="
            background: var(--card-bg, #2a2a2a);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid var(--accent-yellow, #ffc107);
        ">
            <h2 style="color: var(--text-primary, white); text-align: center; margin-bottom: 1.5rem;">‚öΩ –í—ã–±—Ä–∞—Ç—å —Ç–∞–∫—Ç–∏–∫—É</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <div class="tactic-option" data-tactic="balanced" style="
                    background: var(--bg-secondary, #3a3a3a);
                    border: 2px solid var(--border-color, #555);
                    border-radius: 8px;
                    padding: 1rem;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">
                    <h3 style="color: var(--text-primary, white); margin-bottom: 0.5rem;">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞</h3>
                    <p style="color: var(--text-secondary, #ccc); font-size: 0.9rem; margin: 0;">–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–∫—Ç–∏–∫–∞ 50/50</p>
                </div>

                <div class="tactic-option" data-tactic="tiki_taka" style="
                    background: var(--bg-secondary, #3a3a3a);
                    border: 2px solid var(--border-color, #555);
                    border-radius: 8px;
                    padding: 1rem;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">
                    <h3 style="color: var(--text-primary, white); margin-bottom: 0.5rem;">–¢–∏–∫–∏-—Ç–∞–∫–∞</h3>
                    <p style="color: var(--text-secondary, #ccc); font-size: 0.9rem; margin: 0;">–í—ã—Å–æ–∫–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –º—è—á–æ–º, —Å–ø–æ–∫–æ–π–Ω—ã–π —Ñ—É—Ç–±–æ–ª</p>
                </div>

                <div class="tactic-option" data-tactic="catenaccio" style="
                    background: var(--bg-secondary, #3a3a3a);
                    border: 2px solid var(--border-color, #555);
                    border-radius: 8px;
                    padding: 1rem;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">
                    <h3 style="color: var(--text-primary, white); margin-bottom: 0.5rem;">–ö–∞—Ç–µ–Ω–∞—á—á–æ</h3>
                    <p style="color: var(--text-secondary, #ccc); font-size: 0.9rem; margin: 0;">–ê—Ç–∞–∫–∞ –ø–æ—Å–ª–µ –≥–æ–ª–∞, –∑–∞—Ç–µ–º –æ–±–æ—Ä–æ–Ω–∞</p>
                </div>

                <div class="tactic-option" data-tactic="bus" style="
                    background: var(--bg-secondary, #3a3a3a);
                    border: 2px solid var(--border-color, #555);
                    border-radius: 8px;
                    padding: 1rem;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">
                    <h3 style="color: var(--text-primary, white); margin-bottom: 0.5rem;">–ê–≤—Ç–æ–±—É—Å</h3>
                    <p style="color: var(--text-secondary, #ccc); font-size: 0.9rem; margin: 0;">–ì–ª—É—Ö–∞—è –æ–±–æ—Ä–æ–Ω–∞</p>
                </div>

                <div class="tactic-option" data-tactic="all_out_attack" style="
                    background: var(--bg-secondary, #3a3a3a);
                    border: 2px solid var(--border-color, #555);
                    border-radius: 8px;
                    padding: 1rem;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">
                    <h3 style="color: var(--text-primary, white); margin-bottom: 0.5rem;">–í—Å–µ –≤ –∞—Ç–∞–∫—É</h3>
                    <p style="color: var(--text-secondary, #ccc); font-size: 0.9rem; margin: 0;">–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∞—Ç–∞–∫–∞</p>
                </div>
            </div>

            <div style="text-align: center;">
                <button onclick="modal.remove()" style="
                    background: var(--accent-red, #dc3545);
                    color: white;
                    border: none;
                    padding: 0.75rem 1.5rem;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 1rem;
                ">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∞–∫—Ç–∏–∫–∏
    modal.querySelectorAll('.tactic-option').forEach(option => {
        option.addEventListener('click', function() {
            const tactic = this.dataset.tactic;

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–∫—Ç–∏–∫–∏
            fetch('/change_tactic', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    tactic: tactic
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ ' + data.message);
                    modal.remove();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + data.message);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∞–∫—Ç–∏–∫–∏:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∞–∫—Ç–∏–∫–∏');
            });
        });

        // –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        option.addEventListener('mouseenter', function() {
            this.style.borderColor = 'var(--accent-yellow, #ffc107)';
            this.style.transform = 'translateY(-2px)';
        });

        option.addEventListener('mouseleave', function() {
            this.style.borderColor = 'var(--border-color, #555)';
            this.style.transform = 'translateY(0)';
        });
    });

    document.body.appendChild(modal);
}

function startMatch() {
    if (confirm('‚öΩ –ù–∞—á–∞—Ç—å –º–∞—Ç—á?\n\n{{ my_team }} VS {{ opponent_team }}')) {
        window.location.href = '{{ url_for("match") }}';
    }
}
</script>
{% endblock %}

