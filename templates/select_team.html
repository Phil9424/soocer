{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="team-selection">
        <h1 style="font-size: 1.2rem !important; margin-bottom: 0.5rem !important;">‚öΩ –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</h1>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
            –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ({{ teams|length }} –∫–æ–º–∞–Ω–¥)
        </p>

        
        <form method="POST" action="{{ url_for('start_game') }}" class="team-list" style="display: grid !important; grid-template-columns: repeat(3, minmax(80px, 1fr)) !important; gap: 8px !important; margin-bottom: 16px !important; padding: 8px !important; height: auto !important; max-height: none !important; overflow: visible !important; width: 100% !important; box-sizing: border-box !important;">
            {% for team in teams %}
            <button type="submit" name="team" value="{{ team.name }}" class="team-btn" style="padding: 0.5rem !important; background: var(--bg-card) !important; border: 1px solid var(--border-color) !important; border-radius: 4px !important; cursor: pointer !important; transition: all 0.3s ease !important; text-align: center !important; color: var(--text-primary) !important; min-height: 60px !important; display: flex !important; flex-direction: column !important; align-items: center !important; justify-content: center !important; gap: 0.3rem !important; font-size: 0.6rem !important;">
                <div class="logo-container" style="width: 40px !important; height: 40px !important; background: var(--light-blue) !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; font-size: 1.2rem !important;">
                    ‚öΩ
                </div>
                <span style="font-size: 0.5rem !important; font-weight: 600 !important; line-height: 1.1 !important; white-space: nowrap !important; overflow: hidden !important; text-overflow: ellipsis !important; max-width: 100% !important;">{{ team.name }}</span>
            </button>
            {% endfor %}
        </form>
        
        <div style="text-align: center; margin-top: 0.5rem;">
            <a href="{{ url_for('index') }}" class="btn btn-secondary" style="font-size: 0.8rem !important; padding: 0.5rem 1rem !important;">‚Üê –ù–∞–∑–∞–¥</a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
    const preselectedTeam = '{{ preselected_team }}';

    if (preselectedTeam) {
        // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É —Å —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∂–∏–º–∞–µ–º –µ–µ
        const teamButtons = document.querySelectorAll('.team-btn');

        for (const button of teamButtons) {
            if (button.value === preselectedTeam) {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω–¥–∏–∫–∞—Ü–∏—é –≤—ã–±–æ—Ä–∞
                button.style.border = '2px solid var(--primary-color)';
                button.style.background = 'var(--primary-color-light)';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                const message = document.createElement('div');
                message.style.cssText = 'text-align: center; color: var(--primary-color); font-weight: bold; margin-bottom: 1rem;';
                message.textContent = `üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: ${preselectedTeam}`;

                const teamSelection = document.querySelector('.team-selection');
                teamSelection.insertBefore(message, document.querySelector('.team-list'));

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    button.click();
                }, 2000);

                break;
            }
        }
    }

    // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º sessionStorage –Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä
    try {
        const sessionPreselected = sessionStorage.getItem('preselected_team');
        if (sessionPreselected && !preselectedTeam) {
            // –û—á–∏—â–∞–µ–º sessionStorage –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
            sessionStorage.removeItem('preselected_team');
            window.location.href = `/new_game?team=${encodeURIComponent(sessionPreselected)}`;
        }
    } catch (e) {
        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å sessionStorage');
    }
});
</script>

{% endblock %}

