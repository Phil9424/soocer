{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="load-game-page">
        <h1>üíæ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É</h1>
        
        {% if is_vercel %}
        <div id="vercel-saves-container">
            <!-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑ localStorage –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã JavaScript -->
        </div>

        <div id="no-saves-message" class="card" style="text-align: center; padding: 3rem; display: none;">
            <h2 style="color: var(--warning); margin-bottom: 1rem;">üíæ –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–≥—Ä</h2>
            <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 2rem;">
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "üíæ –°–æ—Ö—Ä." –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–≥—Ä—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
            </p>
            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; margin-bottom: 2rem;">
                <strong>üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong><br>
                –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏.<br>
                –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ.
            </div>
            <a href="{{ url_for('index') }}" class="btn btn-primary">üè† –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</a>
        </div>
        {% elif saves %}
        <div class="saves-list">
            {% for save in saves %}
            <div class="save-item">
                <div class="save-info">
                    <strong>üèÜ {{ save.team }}</strong>
                    <span class="save-date">üìÖ {{ save.timestamp }}</span>
                </div>
                <a href="{{ url_for('load_game_file', filename=save.filename) }}" class="btn btn-success">üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å</a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="card" style="text-align: center; padding: 3rem;">
            <p style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 2rem;">
                üíæ –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–≥—Ä
            </p>
            <a href="{{ url_for('index') }}" class="btn btn-primary">üè† –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</a>
        </div>
        {% endif %}
        
        {% if saves and not is_vercel %}
        <div style="text-align: center; margin-top: 2rem;">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</a>
        </div>
        {% endif %}
    </div>
</div>

{% if is_vercel %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadVercelSaves();

    function loadVercelSaves() {
        try {
            const saves = JSON.parse(localStorage.getItem('football_manager_saves') || '[]');

            if (saves.length === 0) {
                document.getElementById('no-saves-message').style.display = 'block';
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
            const container = document.getElementById('vercel-saves-container');
            container.innerHTML = '<h2 style="text-align: center; margin-bottom: 2rem;">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã (–±—Ä–∞—É–∑–µ—Ä)</h2>';

            const savesList = document.createElement('div');
            savesList.className = 'saves-list';

            saves.forEach((save, index) => {
                const saveItem = document.createElement('div');
                saveItem.className = 'save-item';

                const saveInfo = document.createElement('div');
                saveInfo.className = 'save-info';

                const teamName = document.createElement('strong');
                teamName.textContent = 'üèÜ ' + (save.teamName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞');

                const saveDate = document.createElement('span');
                saveDate.className = 'save-date';
                const date = new Date(save.timestamp);
                saveDate.textContent = 'üìÖ ' + date.toLocaleString();

                const saveNote = document.createElement('span');
                saveNote.className = 'save-note';
                saveNote.style.cssText = 'color: var(--text-secondary); font-size: 0.8rem;';
                saveNote.textContent = '(localStorage)';

                saveInfo.appendChild(teamName);
                saveInfo.appendChild(document.createElement('br'));
                saveInfo.appendChild(saveDate);
                saveInfo.appendChild(document.createElement('br'));
                saveInfo.appendChild(saveNote);

                const loadButton = document.createElement('button');
                loadButton.className = 'btn btn-success';
                loadButton.textContent = 'üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å';
                loadButton.onclick = function() {
                    loadFromLocalStorage(index);
                };

                saveItem.appendChild(saveInfo);
                saveItem.appendChild(loadButton);
                savesList.appendChild(saveItem);
            });

            container.appendChild(savesList);

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"
            const backButton = document.createElement('div');
            backButton.style.cssText = 'text-align: center; margin-top: 2rem;';
            backButton.innerHTML = '<a href="/" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</a>';
            container.appendChild(backButton);

        } catch (error) {
            console.error('Error loading saves from localStorage:', error);
            document.getElementById('no-saves-message').style.display = 'block';
        }
    }

    function loadFromLocalStorage(index) {
        try {
            const saves = JSON.parse(localStorage.getItem('football_manager_saves') || '[]');
            if (saves[index]) {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã –∏–∑ localStorage
                // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                alert('‚úÖ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞!\n\n‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é.');
                // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
            }
        } catch (error) {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞: ' + error.message);
        }
    }
});
</script>
{% endif %}

{% endblock %}

